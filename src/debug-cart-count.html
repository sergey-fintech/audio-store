<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Cart Count</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .debug-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .debug-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .debug-button:hover {
            background: #0056b3;
        }
        .result {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            margin: 10px 0;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <!-- Копируем структуру header из catalog.html -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <img src="assets/images/header-logo.svg" alt="Аудитерия">
            </div>
            <nav class="nav-menu">
                <a href="index.html">Каталог</a>
                <a href="cart.html">Корзина (<span id="cart-count">0</span>)</a>
            </nav>
            <div class="nav-actions">
                <button class="search-btn">
                    <img src="assets/images/search-icon.svg" alt="Поиск">
                </button>
                <button class="login-btn">Войти</button>
                <div class="profile">
                    <div class="profile-icon">
                        <img src="assets/images/user-avatar.svg" alt="Аватар">
                    </div>
                    <span class="profile-name">Тестовый пользователь</span>
                </div>
                <button class="logout-btn">Выйти</button>
            </div>
        </div>
    </header>

    <div class="debug-container">
        <h1>Debug Cart Count Element</h1>
        
        <div class="debug-section">
            <h3>Проверка элемента cart-count</h3>
            <button class="debug-button" onclick="checkCartCountElement()">Проверить элемент</button>
            <button class="debug-button" onclick="checkAllElements()">Проверить все элементы</button>
            <button class="debug-button" onclick="checkDOMReady()">Проверить готовность DOM</button>
            <div id="debug-results" class="result">Нажмите кнопку для проверки</div>
        </div>
        
        <div class="debug-section">
            <h3>Тест обновления счетчика</h3>
            <button class="debug-button" onclick="testUpdateCartCount()">Обновить счетчик</button>
            <button class="debug-button" onclick="addTestItem()">Добавить тестовый товар</button>
            <div id="test-results" class="result">Нажмите кнопку для тестирования</div>
        </div>
        
        <div class="debug-section">
            <h3>Информация о скриптах</h3>
            <div id="script-info" class="result">Загрузка...</div>
        </div>
    </div>

    <script>
        // Функция для проверки элемента cart-count
        function checkCartCountElement() {
            const results = document.getElementById('debug-results');
            let output = '';
            
            // Проверяем элемент по ID
            const cartCountElement = document.getElementById('cart-count');
            output += `getElementById('cart-count'): ${cartCountElement ? 'НАЙДЕН' : 'НЕ НАЙДЕН'}\n`;
            
            if (cartCountElement) {
                output += `- Текст: "${cartCountElement.textContent}"\n`;
                output += `- Родитель: ${cartCountElement.parentElement.tagName}\n`;
                output += `- Видимый: ${cartCountElement.offsetParent !== null}\n`;
                output += `- Стили: display=${getComputedStyle(cartCountElement).display}\n`;
            }
            
            // Проверяем все span элементы
            const allSpans = document.querySelectorAll('span');
            output += `\nВсего span элементов: ${allSpans.length}\n`;
            
            allSpans.forEach((span, index) => {
                if (span.id === 'cart-count') {
                    output += `- Span ${index}: id="${span.id}", text="${span.textContent}"\n`;
                }
            });
            
            // Проверяем все элементы с ID
            const allElementsWithId = document.querySelectorAll('[id]');
            output += `\nВсего элементов с ID: ${allElementsWithId.length}\n`;
            
            allElementsWithId.forEach((element, index) => {
                if (element.id === 'cart-count') {
                    output += `- Элемент ${index}: tag="${element.tagName}", id="${element.id}"\n`;
                }
            });
            
            results.textContent = output;
        }
        
        // Функция для проверки всех элементов
        function checkAllElements() {
            const results = document.getElementById('debug-results');
            let output = '';
            
            output += `DOM готов: ${document.readyState}\n`;
            output += `Заголовок: ${document.title}\n`;
            output += `URL: ${window.location.href}\n\n`;
            
            // Проверяем header
            const header = document.querySelector('header');
            output += `Header найден: ${header ? 'ДА' : 'НЕТ'}\n`;
            
            if (header) {
                const navMenu = header.querySelector('.nav-menu');
                output += `Nav-menu найден: ${navMenu ? 'ДА' : 'НЕТ'}\n`;
                
                if (navMenu) {
                    const links = navMenu.querySelectorAll('a');
                    output += `Ссылок в nav-menu: ${links.length}\n`;
                    
                    links.forEach((link, index) => {
                        output += `- Ссылка ${index}: href="${link.href}", text="${link.textContent.trim()}"\n`;
                    });
                }
            }
            
            results.textContent = output;
        }
        
        // Функция для проверки готовности DOM
        function checkDOMReady() {
            const results = document.getElementById('debug-results');
            let output = '';
            
            output += `Document ready state: ${document.readyState}\n`;
            output += `DOMContentLoaded fired: ${window.domContentLoadedFired || 'НЕТ'}\n`;
            output += `Window loaded: ${window.windowLoaded || 'НЕТ'}\n\n`;
            
            // Проверяем, когда был создан элемент
            const cartCountElement = document.getElementById('cart-count');
            if (cartCountElement) {
                output += `Элемент cart-count найден!\n`;
                output += `- Создан: ${cartCountElement.creationTime || 'неизвестно'}\n`;
            } else {
                output += `Элемент cart-count НЕ найден!\n`;
            }
            
            results.textContent = output;
        }
        
        // Функция для тестирования обновления счетчика
        function testUpdateCartCount() {
            const results = document.getElementById('test-results');
            let output = '';
            
            try {
                const cart = JSON.parse(localStorage.getItem('cart')) || [];
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                
                output += `Товаров в корзине: ${totalItems}\n`;
                
                const cartCountElement = document.getElementById('cart-count');
                if (cartCountElement) {
                    cartCountElement.textContent = totalItems;
                    output += `Счетчик обновлен: ${totalItems}\n`;
                } else {
                    output += `ОШИБКА: Элемент cart-count не найден!\n`;
                }
                
            } catch (error) {
                output += `ОШИБКА: ${error.message}\n`;
            }
            
            results.textContent = output;
        }
        
        // Функция для добавления тестового товара
        function addTestItem() {
            const results = document.getElementById('test-results');
            let output = '';
            
            try {
                let cart = JSON.parse(localStorage.getItem('cart')) || [];
                cart.push({
                    id: 'test-' + Date.now(),
                    title: 'Тестовый товар',
                    price: 100,
                    quantity: 1
                });
                
                localStorage.setItem('cart', JSON.stringify(cart));
                output += `Тестовый товар добавлен\n`;
                
                // Обновляем счетчик
                testUpdateCartCount();
                
            } catch (error) {
                output += `ОШИБКА: ${error.message}\n`;
            }
            
            results.textContent = output;
        }
        
        // Отслеживаем события загрузки
        document.addEventListener('DOMContentLoaded', function() {
            window.domContentLoadedFired = 'ДА';
            console.log('DOMContentLoaded fired');
            
            // Проверяем элемент через небольшую задержку
            setTimeout(() => {
                const cartCountElement = document.getElementById('cart-count');
                console.log('Cart count element after DOMContentLoaded:', cartCountElement);
            }, 100);
        });
        
        window.addEventListener('load', function() {
            window.windowLoaded = 'ДА';
            console.log('Window loaded');
            
            // Проверяем элемент после полной загрузки
            setTimeout(() => {
                const cartCountElement = document.getElementById('cart-count');
                console.log('Cart count element after window load:', cartCountElement);
            }, 100);
        });
        
        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            const scriptInfo = document.getElementById('script-info');
            scriptInfo.textContent = `Скрипты загружены. DOM готов: ${document.readyState}`;
            
            // Автоматически проверяем элемент
            setTimeout(() => {
                checkCartCountElement();
            }, 500);
        });
    </script>
</body>
</html>

