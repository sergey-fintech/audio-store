# Микросервис "Корзина"

Микросервис для валидации и расчета стоимости корзины аудиокниг.

## Описание

Сервис предоставляет API для расчета стоимости корзины на основе списка товаров. Он взаимодействует с микросервисом "Каталог" для получения информации об аудиокнигах.

## Запуск

```bash
# Из корневой директории проекта
cd services/cart
python run_app.py

# Или напрямую
python main.py
```

Сервис будет доступен по адресу: `http://localhost:8001`

## Демонстрация

Для демонстрации работы сервиса запустите:

```bash
python demo.py
```

Этот скрипт покажет различные сценарии использования API корзины.

## API Endpoints

### POST /api/v1/cart/calculate

Рассчитывает стоимость корзины на основе списка товаров.

**Входные данные:**
```json
{
  "items": [
    {
      "audiobook_id": 1,
      "quantity": 2
    },
    {
      "audiobook_id": 3,
      "quantity": 1
    }
  ]
}
```

**Выходные данные:**
```json
{
  "items": [
    {
      "audiobook_id": 1,
      "title": "Название аудиокниги",
      "price_per_unit": 299.99,
      "quantity": 2,
      "total_price": 599.98
    },
    {
      "audiobook_id": 3,
      "title": "Другая аудиокнига",
      "price_per_unit": 199.99,
      "quantity": 1,
      "total_price": 199.99
    }
  ],
  "total_price": 799.97,
  "calculated_at": "2024-01-15T10:30:00"
}
```

### GET /health

Проверка состояния сервиса.

## Особенности

1. **Асинхронные запросы**: Все запросы к микросервису "Каталог" выполняются асинхронно для повышения производительности.

2. **Обработка ошибок**: Товары, которые не найдены в каталоге (ошибка 404), игнорируются и не включаются в итоговый расчет.

3. **Параллельная обработка**: Информация о всех аудиокнигах запрашивается параллельно.

4. **Таймауты**: Установлен таймаут 10 секунд для HTTP запросов к микросервису "Каталог".

## Зависимости

- FastAPI
- Pydantic
- httpx (для HTTP клиента)
- uvicorn (для запуска сервера)

## Взаимодействие с другими сервисами

Сервис взаимодействует с микросервисом "Каталог" по адресу `http://localhost:8000/api/v1/audiobooks/{audiobook_id}` для получения информации об аудиокнигах. 