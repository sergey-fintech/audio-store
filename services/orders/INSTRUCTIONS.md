# Инструкции по запуску микросервиса "Заказы"

## Быстрый старт

### 1. Подготовка базы данных
```bash
# Создание таблиц заказов
python create_orders_tables.py
```

### 2. Запуск всех микросервисов
```bash
# Запуск всех сервисов одновременно
python start_services.py
```

### 3. Запуск только микросервиса заказов
```bash
cd services/orders
python run_app.py
```

## Тестирование

### Демонстрация работы
```bash
cd services/orders
python demo.py
```

### Запуск тестов
```bash
cd services/orders
python test_orders.py
```

## API Endpoints

### Создание заказа
```bash
curl -X POST "http://localhost:8003/api/v1/orders" \
  -H "Content-Type: application/json" \
  -d '{
    "items": [
      {"audiobook_id": 1, "quantity": 2},
      {"audiobook_id": 2, "quantity": 1}
    ]
  }'
```

### Получение заказа
```bash
curl "http://localhost:8003/api/v1/orders/1"
```

### Получение списка заказов
```bash
curl "http://localhost:8003/api/v1/orders?limit=10&offset=0"
```

### Обновление статуса заказа
```bash
curl -X PUT "http://localhost:8003/api/v1/orders/1/status?status=confirmed"
```

### Health check
```bash
curl "http://localhost:8003/health"
```

## Требования

### Зависимые сервисы
- **Микросервис "Каталог"** (порт 8001) - для получения информации об аудиокнигах
- **Микросервис "Корзина"** (порт 8002) - для валидации корзины и расчета стоимости

### Порядок запуска
1. Запустить микросервис "Каталог"
2. Запустить микросервис "Корзина"
3. Запустить микросервис "Заказы"

## Структура проекта

```
services/orders/
├── main.py              # Основное приложение FastAPI
├── schemas.py           # Pydantic схемы
├── services.py          # Бизнес-логика
├── run_app.py          # Скрипт запуска
├── test_orders.py      # Тесты
├── demo.py             # Демонстрация
├── README.md           # Документация
└── INSTRUCTIONS.md     # Этот файл
```

## Troubleshooting

### Ошибка "Сервис корзины недоступен"
- Убедитесь, что микросервис "Корзина" запущен на порту 8002
- Проверьте, что микросервис "Каталог" запущен на порту 8001

### Ошибка "Таблицы не найдены"
- Запустите скрипт создания таблиц: `python create_orders_tables.py`

### Ошибка подключения к базе данных
- Проверьте файл `database/connection.py`
- Убедитесь, что база данных существует и доступна

## Мониторинг

### Логи
Сервис выводит логи в консоль с информацией о:
- Запуске и остановке сервиса
- Создании заказов
- Ошибках валидации
- Проблемах с зависимыми сервисами

### Метрики
- Количество созданных заказов
- Время ответа API
- Статусы зависимых сервисов

## Разработка

### Добавление новых эндпоинтов
1. Добавьте схему в `schemas.py`
2. Добавьте метод в `services.py`
3. Добавьте эндпоинт в `main.py`
4. Добавьте тесты в `test_orders.py`

### Изменение бизнес-логики
1. Измените методы в `services.py`
2. Обновите тесты
3. Обновите документацию

## Безопасность

### Валидация входных данных
- Все входные данные валидируются через Pydantic
- Проверка типов и диапазонов значений
- Санитизация данных

### Обработка ошибок
- HTTP статус коды для разных типов ошибок
- Детальные сообщения об ошибках
- Логирование ошибок

### Транзакционность
- Атомарное создание заказов
- Откат при ошибках
- Целостность данных 