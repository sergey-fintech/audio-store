# API –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ –û–ø–∏—Å–∞–Ω–∏–π - –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä

## –û–±–∑–æ—Ä

–ù–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç `/api/v1/recommendations/generate-description/{product_id}` —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω **–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä** –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–ø–∏—Å–∞–Ω–∏–π –∞—É–¥–∏–æ–∫–Ω–∏–≥.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–≠—Ç–æ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º–∏:

1. **Catalog Service** - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–Ω–∏–≥–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è
2. **AI Recommender Service** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∏—è —Å –ø–æ–º–æ—â—å—é LLM
3. **External LLM** (—á–µ—Ä–µ–∑ OpenRouter) - —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

## –≠–Ω–¥–ø–æ–∏–Ω—Ç

### POST `/api/v1/recommendations/generate-description/{product_id}`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–ø–∏—Å–∞–Ω–∏—è –∞—É–¥–∏–æ–∫–Ω–∏–≥–∏ —Å –ø–æ–º–æ—â—å—é AI

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `product_id` (path) - ID –∞—É–¥–∏–æ–∫–Ω–∏–≥–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "model": "gemini-pro"  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é "gemini-pro"
}
```

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏:**
- `gemini-pro` - Google Gemini Pro 1.5
- `gemini-flash` - Google Gemini Flash 1.5 8B
- `claude-3` - Anthropic Claude 3.5 Sonnet
- `gpt-4` - OpenAI GPT-4 Turbo
- `llama-3` - Meta Llama 3 8B Instruct

**–û—Ç–≤–µ—Ç:**
```json
{
  "product_id": 1,
  "generated_description": "–ü—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞—É–¥–∏–æ–∫–Ω–∏–≥–∏...",
  "model": "google/gemini-pro-1.5",
  "model_alias": "gemini-pro",
  "success": true
}
```

## –ü—Ä–æ—Ü–µ—Å—Å –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏

### –®–∞–≥ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–Ω–∏–≥–∏
- **–î–µ–π—Å—Ç–≤–∏–µ:** GET –∑–∞–ø—Ä–æ—Å –∫ `catalog` —Å–µ—Ä–≤–∏—Å—É
- **URL:** `http://localhost:8002/api/v1/audiobooks/{product_id}`
- **–¶–µ–ª—å:** –ü–æ–ª—É—á–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫–Ω–∏–≥–∏ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –∞–≤—Ç–æ—Ä, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Ü–µ–Ω–∞, —Ç–µ–∫—É—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ)

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞
- **–î–µ–π—Å—Ç–≤–∏–µ:** –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è LLM
- **–õ–æ–≥–∏–∫–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Core Domain –∑–Ω–∞–Ω–∏–π –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞
- **–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫–Ω–∏–≥–∏
- **–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–ø–∏—Å–∞–Ω–∏—è

### –®–∞–≥ 3: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∏—è
- **–î–µ–π—Å—Ç–≤–∏–µ:** –í—ã–∑–æ–≤ LLM —á–µ—Ä–µ–∑ OpenRouter API
- **–ú–æ–¥–µ–ª—å:** –í—ã–±—Ä–∞–Ω–Ω–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** 
  - `max_tokens`: 500
  - `temperature`: 0.7
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ

### –®–∞–≥ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞
- **–î–µ–π—Å—Ç–≤–∏–µ:** PUT –∑–∞–ø—Ä–æ—Å –∫ `catalog` —Å–µ—Ä–≤–∏—Å—É
- **URL:** `http://localhost:8002/api/v1/audiobooks/{product_id}`
- **Payload:** `{"description": "—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ_–æ–ø–∏—Å–∞–Ω–∏–µ"}` (—Å—Ö–µ–º–∞ AudiobookUpdate)
- **–¶–µ–ª—å:** –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –û—à–∏–±–æ–∫

### HTTP –ö–æ–¥—ã –û—à–∏–±–æ–∫

- **404** - –ê—É–¥–∏–æ–∫–Ω–∏–≥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
- **503** - Catalog —Å–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- **500** - –û—à–∏–±–∫–∞ LLM –∏–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞

### –¢–∏–ø—ã –û—à–∏–±–æ–∫

1. **–û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ catalog —Å–µ—Ä–≤–∏—Å—É**
   - –¢–∞–π–º–∞—É—Ç (10 —Å–µ–∫—É–Ω–¥)
   - –°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏
   - HTTP –æ—à–∏–±–∫–∏

2. **–û—à–∏–±–∫–∏ LLM**
   - –ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á
   - –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤
   - –û—à–∏–±–∫–∏ –º–æ–¥–µ–ª–∏

3. **–û—à–∏–±–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**
   - –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
   - –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

## –ü—Ä–∏–º–µ—Ä—ã –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### cURL
```bash
curl -X POST "http://localhost:8005/api/v1/recommendations/generate-description/1" \
  -H "Content-Type: application/json" \
  -d '{"model": "gemini-pro"}'
```

### Python
```python
import requests

response = requests.post(
    "http://localhost:8005/api/v1/recommendations/generate-description/1",
    json={"model": "gemini-pro"}
)

if response.status_code == 200:
    result = response.json()
    print(f"–û–ø–∏—Å–∞–Ω–∏–µ: {result['generated_description']}")
else:
    print(f"–û—à–∏–±–∫–∞: {response.status_code}")
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:
```bash
cd services/recommender
python test_description_generation.py
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **Catalog Service** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8002
2. **Recommender Service** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8005
3. **OPENROUTER_API_KEY** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
4. –í –∫–∞—Ç–∞–ª–æ–≥–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞—É–¥–∏–æ–∫–Ω–∏–≥–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–µ—Ä–≤–∏—Å –≤—ã–≤–æ–¥–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏:
- üéØ –ù–∞—á–∞–ª–æ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏
- üìñ –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–Ω–∏–≥–∏
- ü§ñ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞
- ‚ö° –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–ø–∏—Å–∞–Ω–∏—è
- üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ catalog
- üéâ –£—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
- ‚ùå –û—à–∏–±–∫–∏ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
