# CRUD API для аудиокниг

Этот документ описывает полный набор CRUD-операций для управления аудиокнигами в микросервисе каталога.

## Базовый URL

```
http://localhost:8002/api/v1/audiobooks
```

## Эндпоинты

### 1. Создание аудиокниги

**POST** `/api/v1/audiobooks`

Создает новую аудиокнигу в каталоге.

#### Тело запроса

```json
{
  "title": "Название аудиокниги",
  "author_id": 1,
  "price": "29.99",
  "description": "Описание аудиокниги",
  "cover_image_url": "https://example.com/cover.jpg",
  "category_ids": [1, 2]
}
```

#### Параметры

- `title` (обязательный): Название аудиокниги (максимум 255 символов)
- `author_id` (обязательный): ID автора (должен существовать в базе данных)
- `price` (обязательный): Цена аудиокниги (больше или равно 0)
- `description` (опциональный): Описание аудиокниги
- `cover_image_url` (опциональный): URL обложки (максимум 500 символов)
- `category_ids` (опциональный): Список ID категорий

#### Ответ

**Успех (200/201):**
```json
{
  "id": 1,
  "title": "Название аудиокниги",
  "description": "Описание аудиокниги",
  "price": 29.99,
  "cover_image_url": "https://example.com/cover.jpg",
  "author": {
    "id": 1,
    "name": "Имя автора"
  },
  "categories": [
    {
      "id": 1,
      "name": "Название категории"
    }
  ]
}
```

**Ошибка (404):**
```json
{
  "detail": "Автор не найден"
}
```

### 2. Получение аудиокниги по ID

**GET** `/api/v1/audiobooks/{audiobook_id}`

Получает информацию об аудиокниге по её ID.

#### Параметры пути

- `audiobook_id` (обязательный): ID аудиокниги

#### Ответ

**Успех (200):**
```json
{
  "id": 1,
  "title": "Название аудиокниги",
  "description": "Описание аудиокниги",
  "price": 29.99,
  "cover_image_url": "https://example.com/cover.jpg",
  "author": {
    "id": 1,
    "name": "Имя автора"
  },
  "categories": [
    {
      "id": 1,
      "name": "Название категории"
    }
  ]
}
```

**Ошибка (404):**
```json
{
  "detail": "Аудиокнига не найдена"
}
```

### 3. Получение списка аудиокниг

**GET** `/api/v1/audiobooks`

Получает список всех аудиокниг с поддержкой пагинации.

#### Query параметры

- `limit` (опциональный): Количество записей на страницу
- `offset` (опциональный): Смещение для пагинации

#### Пример запроса

```
GET /api/v1/audiobooks?limit=10&offset=0
```

#### Ответ

**Успех (200):**
```json
[
  {
    "id": 1,
    "title": "Название аудиокниги",
    "description": "Описание аудиокниги",
    "price": 29.99,
    "cover_image_url": "https://example.com/cover.jpg",
    "author": {
      "id": 1,
      "name": "Имя автора"
    },
    "categories": [
      {
        "id": 1,
        "name": "Название категории"
      }
    ]
  }
]
```

### 4. Обновление аудиокниги

**PUT** `/api/v1/audiobooks/{audiobook_id}`

Обновляет информацию об аудиокниге.

#### Параметры пути

- `audiobook_id` (обязательный): ID аудиокниги

#### Тело запроса

```json
{
  "title": "Обновленное название",
  "price": "39.99",
  "description": "Обновленное описание",
  "category_ids": [1, 3]
}
```

Все поля опциональны. Обновляются только переданные поля.

#### Ответ

**Успех (200):**
```json
{
  "id": 1,
  "title": "Обновленное название",
  "description": "Обновленное описание",
  "price": 39.99,
  "cover_image_url": "https://example.com/cover.jpg",
  "author": {
    "id": 1,
    "name": "Имя автора"
  },
  "categories": [
    {
      "id": 1,
      "name": "Название категории"
    },
    {
      "id": 3,
      "name": "Другая категория"
    }
  ]
}
```

**Ошибка (404):**
```json
{
  "detail": "Аудиокнига не найдена"
}
```

### 5. Удаление аудиокниги

**DELETE** `/api/v1/audiobooks/{audiobook_id}`

Удаляет аудиокнигу из каталога.

#### Параметры пути

- `audiobook_id` (обязательный): ID аудиокниги

#### Ответ

**Успех (200):**
```json
{
  "message": "Аудиокнига успешно удалена",
  "id": 1
}
```

**Ошибка (404):**
```json
{
  "detail": "Аудиокнига не найдена"
}
```

## Коды ошибок

- **200**: Успешная операция
- **201**: Ресурс успешно создан
- **404**: Ресурс не найден
- **500**: Внутренняя ошибка сервера

## Примеры использования

### Создание аудиокниги

```bash
curl -X POST "http://localhost:8002/api/v1/audiobooks" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Война и мир",
    "author_id": 1,
    "price": "19.99",
    "description": "Классический роман Льва Толстого",
    "category_ids": [1, 2]
  }'
```

### Получение аудиокниги

```bash
curl -X GET "http://localhost:8002/api/v1/audiobooks/1"
```

### Обновление аудиокниги

```bash
curl -X PUT "http://localhost:8002/api/v1/audiobooks/1" \
  -H "Content-Type: application/json" \
  -d '{
    "price": "24.99",
    "description": "Обновленное описание"
  }'
```

### Удаление аудиокниги

```bash
curl -X DELETE "http://localhost:8002/api/v1/audiobooks/1"
```

## Тестирование

Для тестирования API используйте файл `test_crud.py`:

```bash
cd services/catalog
python test_crud.py
```

Этот скрипт проверит все CRUD операции и обработку ошибок.
